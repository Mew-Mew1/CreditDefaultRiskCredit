<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Credit Default Risk Predictor</title>
  <style>
    /* --- CSS Variables --- */
    :root {
      --primary: #2563eb;
      --primary-hover: #1d4ed8;
      --bg-color: #f8fafc;
      --card-bg: #ffffff;
      --text-main: #1e293b;
      --text-muted: #64748b;
      --border: #e2e8f0;
      --radius: 8px;
      
      /* Status Colors */
      --success-bg: #dcfce7;
      --success-text: #166534;
      --success-bar: #22c55e;
      
      --danger-bg: #fee2e2;
      --danger-text: #991b1b;
      --danger-bar: #ef4444;
    }

    /* --- Global Styles --- */
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 40px 20px;
    }

    /* --- Card Container --- */
    .container {
      background-color: var(--card-bg);
      padding: 32px 40px;
      border-radius: var(--radius);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      width: 100%;
      max-width: 450px;
    }

    h2 { margin-top: 0; font-size: 1.5rem; color: var(--text-main); margin-bottom: 4px; }
    p.subtitle { color: var(--text-muted); font-size: 0.9rem; margin-top: 0; margin-bottom: 24px; }

    /* --- Form Styles --- */
    .form-group { margin-bottom: 16px; }

    label {
      display: block; font-size: 0.875rem; font-weight: 500;
      margin-bottom: 6px; color: var(--text-main);
    }

    input[type="number"] {
      width: 100%; padding: 10px 12px; border: 1px solid var(--border);
      border-radius: var(--radius); font-size: 1rem; box-sizing: border-box;
      transition: all 0.2s ease; background-color: #f8fafc;
    }

    input[type="number"]:focus {
      outline: none; border-color: var(--primary); background-color: #ffffff;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
    }

    /* --- Button Styles --- */
    button {
      width: 100%; padding: 12px; background-color: var(--primary); color: white;
      border: none; border-radius: var(--radius); font-size: 1rem; font-weight: 600;
      cursor: pointer; margin-top: 12px; transition: background-color 0.2s ease;
    }
    button:hover { background-color: var(--primary-hover); }
    button:disabled { background-color: #94a3b8; cursor: not-allowed; }

    /* --- Professional Results Section --- */
    .result-section {
      margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border);
      display: none; 
    }
    
    .result-section h3 { margin-top: 0; font-size: 1.1rem; margin-bottom: 16px; }

    /* Result Card Dashboard */
    .result-card {
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      background-color: #f8fafc;
    }

    .result-header {
      display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;
    }

    .result-title { font-weight: 600; color: var(--text-main); font-size: 1.05rem; }

    .badge {
      padding: 6px 14px; border-radius: 20px; font-weight: 700; font-size: 0.85rem;
      text-transform: uppercase; letter-spacing: 0.5px;
    }

    .prob-label {
      display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 8px; color: var(--text-muted);
    }

    #probValue { font-weight: 700; color: var(--text-main); font-size: 1rem; }

    /* Progress Bar */
    .progress-bar-container {
      width: 100%; height: 8px; background-color: #e2e8f0; border-radius: 4px; overflow: hidden;
    }
    .progress-bar { height: 100%; width: 0%; transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1); }

    /* Dynamic Risk Themes */
    .risk-low .badge { background-color: var(--success-bg); color: var(--success-text); }
    .risk-low .progress-bar { background-color: var(--success-bar); }
    
    .risk-high .badge { background-color: var(--danger-bg); color: var(--danger-text); }
    .risk-high .progress-bar { background-color: var(--danger-bar); }

    /* Error Message Box */
    .error-box {
      background-color: var(--danger-bg); color: var(--danger-text); padding: 12px;
      border-radius: var(--radius); font-size: 0.9rem; text-align: center; display: none;
    }
  </style>
</head>
<body>

  <div class="container">
    <h2>Credit Default Risk Predictor</h2>
    <p class="subtitle">Enter client details to assess default probability</p>

    <form id="predictForm">
      <div class="form-group"><label for="LIMIT_BAL">Limit Balance (NT$)</label><input type="number" id="LIMIT_BAL" name="LIMIT_BAL" value="20000" required></div>
      <div class="form-group"><label for="SEX">Sex (1=Male, 2=Female)</label><input type="number" id="SEX" name="SEX" value="2" required></div>
      <div class="form-group"><label for="EDUCATION">Education (1=Grad, 2=Uni, 3=High School)</label><input type="number" id="EDUCATION" name="EDUCATION" value="2" required></div>
      <div class="form-group"><label for="MARRIAGE">Marital Status (1=Married, 2=Single, 3=Others)</label><input type="number" id="MARRIAGE" name="MARRIAGE" value="1" required></div>
      <div class="form-group"><label for="AGE">Age</label><input type="number" id="AGE" name="AGE" value="35" required></div>
      <div class="form-group"><label for="PAY_0">Repayment Status in Sep (PAY_0)</label><input type="number" id="PAY_0" name="PAY_0" value="0" required></div>
      <div class="form-group"><label for="PAY_2">Repayment Status in Aug (PAY_2)</label><input type="number" id="PAY_2" name="PAY_2" value="0" required></div>
      <div class="form-group"><label for="BILL_AMT1">Bill Statement Amount in Sep (NT$)</label><input type="number" id="BILL_AMT1" name="BILL_AMT1" value="3913" required></div>
      <div class="form-group"><label for="BILL_AMT2">Bill Statement Amount in Aug (NT$)</label><input type="number" id="BILL_AMT2" name="BILL_AMT2" value="3102" required></div>
      <div class="form-group"><label for="PAY_AMT1">Previous Payment in Sep (NT$)</label><input type="number" id="PAY_AMT1" name="PAY_AMT1" value="0" required></div>
      <div class="form-group"><label for="PAY_AMT2">Previous Payment in Aug (NT$)</label><input type="number" id="PAY_AMT2" name="PAY_AMT2" value="689" required></div>

      <button type="submit" id="submitBtn">Generate Prediction</button>
    </form>

    <div class="result-section" id="resultSection">
      <h3>Analysis Result</h3>
      
      <div id="resultCard" class="result-card">
        <div class="result-header">
          <span class="result-title">Overall Assessment</span>
          <span id="riskBadge" class="badge">Low Risk</span>
        </div>
        
        <div class="result-body">
          <div class="prob-label">
            <span>Probability of Default</span>
            <span id="probValue">0.0%</span>
          </div>
          <div class="progress-bar-container">
            <div id="progressBar" class="progress-bar"></div>
          </div>
        </div>
      </div>

      <div id="errorBox" class="error-box"></div>
    </div>
  </div>

  <script>
    document.getElementById("predictForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      
      const submitBtn = document.getElementById("submitBtn");
      const resultSection = document.getElementById("resultSection");
      const resultCard = document.getElementById("resultCard");
      const errorBox = document.getElementById("errorBox");
      const riskBadge = document.getElementById("riskBadge");
      const probValue = document.getElementById("probValue");
      const progressBar = document.getElementById("progressBar");

      // UI update: Loading state
      submitBtn.textContent = "Analyzing data...";
      submitBtn.disabled = true;
      resultSection.style.display = "none";
      errorBox.style.display = "none";
      resultCard.style.display = "block";
      progressBar.style.width = "0%"; // Reset bar

      try {
        const formData = new FormData(e.target);
        const jsonData = {};
        formData.forEach((value, key) => jsonData[key] = isNaN(value) ? value : Number(value));

        const response = await fetch("http://127.0.0.1:5000/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(jsonData)
        });

        const result = await response.json();
        
        if(response.ok) {
          // --- Update the UI with fetched data ---
          
          // Format 0.49297 to 49.3%
          const percentage = (result.probability_of_default * 100).toFixed(1); 
          
          riskBadge.textContent = `${result.risk_level} Risk`;
          probValue.textContent = `${percentage}%`;
          
          // Animate the progress bar
          setTimeout(() => {
            progressBar.style.width = `${percentage}%`;
          }, 100);

          // Apply color themes based on the risk level
          resultCard.className = "result-card"; // Reset classes
          if (result.risk_level === "High" || result.prediction === 1) {
            resultCard.classList.add("risk-high");
          } else {
            resultCard.classList.add("risk-low");
          }
        } else {
          throw new Error(result.error || "Server returned an error");
        }

      } catch (error) {
        resultCard.style.display = "none";
        errorBox.textContent = `Error: Could not process prediction. Make sure Flask API is running. (${error.message})`;
        errorBox.style.display = "block";
      } finally {
        // Show the results block & reset button
        resultSection.style.display = "block";
        submitBtn.textContent = "Generate Prediction";
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>